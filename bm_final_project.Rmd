---
title: "bm_final_project"
author: "Yun He"
date: "December 6, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(faraway)
library(leaps)
library(caret)
library(boot)
library(broom)
```

```{r}
cancer = read_csv("./Cancer_Registry.csv")
colSums(is.na(cancer)) # 'PctSomeCol18_24', 'PctEmployed16_Over','PctPrivateCoverageAlone' should be removed because they have lots of NA.  
```

```{r}
cancer = read_csv("./Cancer_Registry.csv") %>% 
  select(-PctSomeCol18_24, -PctEmployed16_Over, -PctPrivateCoverageAlone) %>% 
  # set the cutoff for low and high income as 47k
  mutate(medIncome = as.numeric(medIncome)) %>% 
  mutate(income_cutoff = ifelse(medIncome >= mean(cancer$medIncome),1,0)) %>%
  # set the cutoff for age at mean median age 
  mutate(age_cutoff = ifelse(MedianAge >= mean(cancer$MedianAge),1,0)) %>%
  separate(Geography, into = c("County", "State"), sep = ",") %>%
  # remove unnecessary columns 'binnedInc'sicne we have already set the cutoff for income and 'PctNoHS18_24' should be removed because there is no corresponding variable for people who are 25 and over.
  select(-binnedInc, -PctNoHS18_24) %>% 
  # make dependent variable at 1st column 
  select(TARGET_deathRate, everything())
  # see the correlation
cancer_cor = cancer %>% 
  select(-State, -County)
cor(cancer_cor) %>% knitr::kable()
  # get descriptive information of cancer 
attach(cancer)
summary(cancer)
```

```{r}
 # make multilinear regression model to see which variables are significant 
multi.fit <- lm(TARGET_deathRate ~ ., data = cancer_cor)
summary(multi.fit)
```

```{r}
  # select 10 variables that we choosen after compare with the information from the research literature 
cancer_model = cancer %>% 
  select(TARGET_deathRate, avgAnnCount, incidenceRate, AvgHouseholdSize, studyPerCap, income_cutoff, age_cutoff, PercentMarried, PctPrivateCoverage, PctWhite, PctHS25_Over)  
 # make histogram to see the distribution of the variables and decide whether we need transformation 
cancer_model %>%
  select(-income_cutoff, -age_cutoff) %>%
  gather(measure, value) %>%
  ggplot(aes(value)) +
  facet_wrap(. ~ measure, scales = "free") +
  geom_histogram()
 # all the correlation value are below 0.7, so there is no covariances. 
 cor(cancer_model) %>% knitr::kable()
```

